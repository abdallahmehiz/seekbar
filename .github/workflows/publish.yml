name: Publish
on:
  release:
    types: [released, prereleased]
jobs:
  publish:
    name: Release build and publish
    runs-on: macOS-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4
      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: 21
      - name: Make ./gradlew Executable
        run: chmod +x ./gradlew
      - name: Publish Release
        env:
          SIGNING_KEY: ${{ secrets.SIGNING_KEY_BASE64 }}
          SIGNING_PASSWORD: ${{ secrets.SIGNING_KEY_PASSWORD }}
          SIGNING_KEY_ID: ${{ secrets.SIGNING_KEY_ID }}
          MAVEN_CENTRAL_USERNAME: ${{ secrets.MAVEN_CENTRAL_USERNAME }}
          MAVEN_CENTRAL_PASSWORD: ${{ secrets.MAVEN_CENTRAL_PASSWORD }}
        run: |
          echo "$SIGNING_KEY" | base64 -d > /tmp/keyring.gpg
          ./gradlew publishAllPublicationsToMavenCentralRepository \
            -Psigning.secretKeyRingFile=/tmp/keyring.gpg \
            -Psigning.password="$SIGNING_PASSWORD" \
            -Psigning.keyId="$SIGNING_KEY_ID" \
            -PmavenCentralUsername="$MAVEN_CENTRAL_USERNAME" \
            -PmavenCentralPassword="$MAVEN_CENTRAL_PASSWORD"
          rm -f /tmp/keyring.gpg


